# Chrome 拡張機能：画像黒色切り替え

ウェブページ内の画像を黒色に切り替える Chrome 拡張機能です。

## 機能

- ボタンクリックで現在の Web ページ内の全画像をピンク色（#ffcce5）に切り替え
- 再度ボタンクリックで元の画像に復元
- アイコンサイズ（32x32px 以下）や SVG 画像は除外
- 画像のサイズとアスペクト比は維持
- ラグなしの瞬間切り替え

## Chrome 拡張機能のインストール手順

### 1. Chrome 拡張機能の開発者モードを有効にする

1. **Chrome ブラウザを開く**
2. **アドレスバーに以下を入力して Enter キー**
   ```
   chrome://extensions/
   ```
3. **右上の「開発者モード」トグルを ON にする**
   - ページ右上にあるスイッチをクリックして青色にする

### 2. 拡張機能を読み込む

1. **「パッケージ化されていない拡張機能を読み込む」ボタンをクリック**
   - 開発者モードを有効にすると表示されるボタン
2. **ファイル選択ダイアログで `chrome-extension` フォルダを選択**
   - このプロジェクトの `chrome-extension` フォルダを選択
3. **「選択」ボタンをクリック**
4. **拡張機能が読み込まれ、ツールバーにアイコンが表示される**

### 3. 拡張機能の確認

- Chrome 拡張機能ページに「Image Blackout Toggle」が表示される
- ブラウザのツールバー（アドレスバー右側）にアイコンが表示される
- アイコンが見えない場合は、パズルピースアイコンをクリックして拡張機能一覧から選択

## 使用方法

### 1. テストページを開く

1. **`test-page.html` をブラウザで開く**
   - ファイルをダブルクリック、または
   - ブラウザにファイルをドラッグ&ドロップ
2. **または任意の Web ページ（画像が含まれるページ）を開く**

### 2. 拡張機能を使用する

1. **ツールバーの拡張機能アイコンをクリック**
2. **ポップアップが開いたら「画像をピンク色に変更」ボタンをクリック**
3. **ページ内の画像が瞬時にピンク色に変わる**
4. **「元の画像に戻す」ボタンをクリックして元に戻す**

## ファイル構成

```
chrome-extension/
├── manifest.json          # 拡張機能の設定ファイル
├── content.js            # メイン機能のスクリプト
├── popup.html            # ポップアップのUI
├── popup.js              # ポップアップの制御
└── icons/                # 拡張機能のアイコン
    ├── icon16.png
    ├── icon48.png
    └── icon128.png

test-page.html             # テスト用ページ
README.md                  # このファイル
```

## トラブルシューティング

### 拡張機能が表示されない場合

1. **Chrome 拡張機能ページ（chrome://extensions/）で確認**

   - 拡張機能が有効になっているか確認
   - エラーメッセージが表示されていないか確認

2. **ツールバーにアイコンが見えない場合**
   - ツールバー右端のパズルピースアイコンをクリック
   - 拡張機能一覧から「Image Blackout Toggle」を探す
   - ピンアイコンをクリックしてツールバーに固定

### 画像が切り替わらない場合

1. **対象外の画像の可能性**

   - SVG 画像は対象外
   - 32x32px 以下の小さなアイコンは対象外

2. **画像の読み込み待ち**

   - ページ読み込み直後は画像がまだ読み込まれていない可能性
   - 少し待ってから再試行

3. **ページのリロード**
   - ページをリロード（F5 キー）してから再試行

### エラーが発生する場合

1. **開発者ツールでエラー確認**

   - F12 キーで開発者ツールを開く
   - Console タブでエラーメッセージを確認

2. **拡張機能の再読み込み**
   - Chrome 拡張機能ページで「再読み込み」ボタンをクリック

## 技術仕様

- **Manifest Version**: 3
- **対象画像**: `<img>`要素（SVG 除外、32x32px 以下除外）
- **画像生成**: Canvas API で黒色画像を動的生成
- **パフォーマンス**: 事前生成とキャッシュでラグなし切り替え
- **メモリ管理**: WeakMap で効率的な状態管理
